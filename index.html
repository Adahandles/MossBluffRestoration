<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF‑8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Moss Bluff Restoration Project</title>
  <!-- Leaflet base CSS (loaded from a more reliable CDN) -->
  <link
    rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.css"
    crossorigin=""
  />
  <style>
    /* Simple responsive layout */
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
      color: #222;
      background: #f2f5fa;
    }
    header {
      background: #124559;
      color: #fff;
      padding: 20px;
      text-align: center;
    }
    nav {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      background: #0e3145;
    }
    nav a {
      color: #fff;
      margin: 0 15px;
      padding: 10px 0;
      text-decoration: none;
    }
    nav a:hover {
      text-decoration: underline;
    }
    .content {
      max-width: 1200px;
      margin: auto;
      padding: 20px;
    }
    h2 {
      color: #124559;
      margin-top: 1.5em;
    }
    #map {
      width: 100%;
      height: 600px;
      border: 1px solid #ccc;
      border-radius: 4px;
      margin-bottom: 20px;
    }
    .doc-links ul {
      list-style-type: none;
      padding-left: 0;
    }
    .doc-links li {
      margin-bottom: 0.5em;
    }
    footer {
      background: #124559;
      color: #fff;
      text-align: center;
      padding: 10px;
    }
  </style>
</head>
<body>
  <header>
    <h1>Moss Bluff Wetland Restoration Project</h1>
    <p>Restoring and preserving the Moss Bluff wetlands through community‑driven restoration and sustainable practices.</p>
  </header>
  <nav>
    <a href="#overview">Project Overview</a>
    <a href="#map-section">Interactive Map</a>
    <a href="#documents">Documents</a>
    <a href="#contact">Contact</a>
  </nav>

  <div class="content">
    <section id="overview">
      <h2>Project Overview</h2>
      <p>
        The Moss Bluff Restoration Project aims to restore and enhance the wetland ecosystem on the Moss Bluff property in Florida.
        The project will mitigate flooding, improve water quality, restore native vegetation, and provide educational and recreational
        opportunities. Restoration efforts are guided by research, local knowledge, and collaboration with agencies and stakeholders.
      </p>
    </section>

    <section id="map-section">
      <h2>Interactive Restoration Map</h2>
      <p>
        Use the map below to explore overlays showing flood zones and parcel boundaries. Toggle layers on or off to visualize
        how the proposed restoration activities intersect with existing site conditions. Zoom in or out and click on features
        for details.
      </p>
      <div id="map"></div>
    </section>

    <section id="documents">
      <h2>Project Documents</h2>
      <p>Review our project documents below. Clicking a document opens it in an online viewer rather than downloading the file.</p>
      <div class="doc-links">
        <ul>
          <!-- Updated document links to reference the actual project files uploaded to the repository. -->
          <li><a href="https://view.officeapps.live.com/op/embed.aspx?src=https://raw.githubusercontent.com/Adahandles/MossBluffRestoration/main/Fountara_Moss_Bluff_Grant_Proposal_v1.docx" target="_blank">Grant Proposal (View)</a></li>
          <li><a href="https://view.officeapps.live.com/op/embed.aspx?src=https://raw.githubusercontent.com/Adahandles/MossBluffRestoration/main/Moss_Bluff_Wetland_Restoration_Brief.docx" target="_blank">Restoration Brief (View)</a></li>
          <li><a href="https://view.officeapps.live.com/op/embed.aspx?src=https://raw.githubusercontent.com/Adahandles/MossBluffRestoration/main/Moss_Bluff_Conditional_Purchase_and_Grantnomics_Plan.docx" target="_blank">Conditional Purchase &amp; Grantnomics Plan (View)</a></li>
          <li><a href="https://view.officeapps.live.com/op/embed.aspx?src=https://raw.githubusercontent.com/Adahandles/MossBluffRestoration/main/Fountara_Contractor_Document_Checklist.docx" target="_blank">Contractor Document Checklist (View)</a></li>
        </ul>
      </div>
    </section>

    <section id="contact">
      <h2>Contact &amp; Partnerships</h2>
      <p>
        Interested in collaborating? If you represent an agency, nonprofit organization, academic institution, or private sector partner
        with interest in wetland restoration and community resilience, we invite you to reach out. Together, we can restore and protect
        Moss Bluff wetlands.
      </p>
      <p>Email us at <a href="mailto:info@fountara.com">info@fountara.com</a></p>
    </section>
  </div>

  <footer>
    &copy; 2025 Fountara, LLC. All rights reserved.
  </footer>

  <!-- Leaflet JS and Esri Leaflet Plugin (loaded from CDNs accessible in restricted environments) -->
  <script
    src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.js"
    crossorigin=""
  ></script>
  <script src="https://cdn.jsdelivr.net/npm/esri-leaflet@3.0.9/dist/esri-leaflet.js"></script>
  <script>
    // Initialize the map and set a reasonable default view near Moss Bluff, FL
    var map = L.map('map').setView([29.4767, -81.8194], 12);

    // Add a base map from OpenStreetMap
    L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: '&copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors'
    }).addTo(map);

    // Define overlay layers using Marion County and FEMA map services
    // Parcel boundaries from the Marion County Property Appraiser via the City of Ocala GIS MapServer
    var parcelsLayer = L.esri.dynamicMapLayer({
      url: 'https://gis.ocalafl.org/arcgis/rest/services/Public/Parcels/MapServer',
      opacity: 0.6
    });

    // FEMA flood zones from the Marion County GIS open data site (MapServer)
    var floodLayer = L.esri.dynamicMapLayer({
      // Updated to use specific sublayers from the Marion County GIS server rather than ArcGIS Online.
      // Specifying layer IDs ensures the flood zones are visible and can be toggled in the layer control.
      url: 'https://gis.marionfl.org/public/rest/services/General/Flood_Zones/MapServer',
      layers: [2, 3, 6, 7], // FEMA Flood Zones 2017 (IDs 2 & 3) and Flood Prone/Transitional Areas (IDs 6 & 7)
      opacity: 0.6
    });

    // Define overlay collection for the layer control
    var overlayMaps = {
      'Parcel Boundaries': parcelsLayer,
      'Flood Zones (2017)': floodLayer
    };

    // Some map controls (e.g. the Esri dynamic map layer) do not automatically
    // hide when toggled via the layer control. To ensure the flood zones layer
    // can be turned off, listen for overlayadd and overlayremove events and
    // explicitly add or remove the floodLayer. When the overlay is added,
    // restore the sublayers; when it is removed, remove it from the map.
    map.on('overlayadd', function (e) {
      if (e.name === 'Flood Zones (2017)') {
        // Add the layer and restore its sublayers
        floodLayer.setLayers([2, 3, 6, 7]);
        map.addLayer(floodLayer);
      }
    });
    map.on('overlayremove', function (e) {
      if (e.name === 'Flood Zones (2017)') {
        // Remove the layer when toggled off
        map.removeLayer(floodLayer);
      }
    });

    // Add layer control to the map and keep a reference so we can add overlays later
    var layerControl = L.control.layers(null, overlayMaps, { collapsed: false }).addTo(map);

    // Display both overlays by default
    parcelsLayer.addTo(map);
    floodLayer.addTo(map);

    // We'll store references to parcel layers so we can zoom to their bounds once both are loaded
    var userParcelsLayer;
    var govParcelsLayer;
    var rayonierLayer;

    // Helper function to fit the map bounds once both parcel layers are available
    function maybeFitToParcels() {
      // Fit to bounds only when all three parcel layers are loaded
      if (userParcelsLayer && govParcelsLayer && rayonierLayer) {
        var bounds = userParcelsLayer.getBounds()
          .extend(govParcelsLayer.getBounds())
          .extend(rayonierLayer.getBounds());
        map.fitBounds(bounds);
      }
    }

    // Load and highlight the user-selected parcels from a GeoJSON file
    fetch('user_parcels.geojson')
      .then(function (response) { return response.json(); })
      .then(function (data) {
        userParcelsLayer = L.geoJSON(data, {
          style: function (feature) {
            return { color: '#e60000', weight: 2, fillOpacity: 0.2 };
          },
          onEachFeature: function (feature, layer) {
            var props = feature.properties || {};
            var name = props.NAME || props.name || 'Parcel';
            var parcel = props.PARCEL || props.parcel || '';
            var acres = props.ACRES || props.acres || '';
            var info = '<strong>' + name + '</strong>';
            if (parcel) { info += '<br/>Parcel: ' + parcel; }
            if (acres) { info += '<br/>Acres: ' + acres; }
            layer.bindPopup(info);
          }
        });
        userParcelsLayer.addTo(map);
        layerControl.addOverlay(userParcelsLayer, 'User Parcels');
        // Try to fit bounds if both layers are loaded
        maybeFitToParcels();
      });

    // Load and highlight government parcels from a GeoJSON file
    fetch('gov_parcels.geojson')
      .then(function (response) { return response.json(); })
      .then(function (data) {
        govParcelsLayer = L.geoJSON(data, {
          style: function (feature) {
            return { color: '#00782b', weight: 2, fillOpacity: 0.2 };
          },
          onEachFeature: function (feature, layer) {
            var props = feature.properties || {};
            var name = props.NAME || props.name || 'Parcel';
            var parcel = props.PARCEL || props.parcel || '';
            var acres = props.ACRES || props.acres || '';
            var info = '<strong>' + name + '</strong>';
            if (parcel) { info += '<br/>Parcel: ' + parcel; }
            if (acres) { info += '<br/>Acres: ' + acres; }
            layer.bindPopup(info);
          }
        });
        govParcelsLayer.addTo(map);
        layerControl.addOverlay(govParcelsLayer, 'Government Parcels');
        // Try to fit bounds if both layers are loaded
        maybeFitToParcels();
      });

    // Load and highlight the adjacent Rayonier parcel from a GeoJSON file
    fetch('rayonier_parcel.geojson')
      .then(function (response) { return response.json(); })
      .then(function (data) {
        rayonierLayer = L.geoJSON(data, {
          style: function (feature) {
            // Use a distinct color (orange) for the adjacent parcel layer
            return { color: '#ff7800', weight: 2, fillOpacity: 0.2 };
          },
          onEachFeature: function (feature, layer) {
            var props = feature.properties || {};
            var name = props.NAME || props.name || 'Parcel';
            var parcel = props.PARCEL || props.parcel || '';
            var acres = props.ACRES || props.acres || '';
            var info = '<strong>' + name + '</strong>';
            if (parcel) { info += '<br/>Parcel: ' + parcel; }
            if (acres) { info += '<br/>Acres: ' + acres; }
            layer.bindPopup(info);
          }
        });
        rayonierLayer.addTo(map);
        layerControl.addOverlay(rayonierLayer, 'Adjacent Parcel');
        // Try to fit bounds once all parcel layers are loaded
        maybeFitToParcels();
      });

  </script>
</body>
</html>